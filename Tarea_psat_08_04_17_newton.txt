clear

basemva=100;

%Acelerar
accel=1;

%Exactitud
accuracy=0.00001;

maxiter=80;

% 1--slack
% 0--load
% 2--generation


busdata(:,1) = xlsread('bus.xlsx', 1, 'A6:A19');
busdata(1,2) = 1; busdata(2:3,2) = 2; busdata(4:14,2) = 0; busdata(6,2) = 2; ; busdata(8,2) = 2; 
busdata(:,3) = xlsread('bus.xlsx', 1, 'B6:B19');
busdata(:,4) = 0;
busdata(:,5) = xlsread('bus.xlsx', 1, 'F6:F19');% load
busdata(:,6) = xlsread('bus.xlsx', 1, 'G6:G19');
busdata(:,7) = xlsread('bus.xlsx', 1, 'D6:D19');%Gen
busdata(:,8) = xlsread('bus.xlsx', 1, 'E6:E19');
busdata(:,9) = xlsread('bus.xlsx', 1, 'H6:H19');
busdata(:,10) = xlsread('bus.xlsx', 1, 'I6:I19');
busdata(:,11) = 0;

%busdata=[];
%        1        2       3        4     5       6       7       8        9       10      11    
%	bus	bus	voltage	angle	----Load----	-----Generator-----Injected
%	No	code	mag	degree	MW	Mvar	MW	Mvar	Qmin	Qmax	Mvar	

linedata(:,1) = xlsread('linea.xlsx', 1, 'B8:B27');
linedata(:,2) = xlsread('linea.xlsx', 1, 'C8:C27');
linedata(:,3) = xlsread('linea.xlsx', 1, 'D8:D27');
linedata(:,4) = xlsread('linea.xlsx', 1, 'E8:E27');
linedata(:,5) = xlsread('linea.xlsx', 1, 'F8:F27');

linedata(:,6) = 1;
linedata(8,6) = 0.978;
linedata(9,6) = 0.969;
linedata(10,6) = 0.932;

%linedata=[];
%         1       2      3      4         5       6             
%	Bus	bus	R	X	1/2 B	TAP
%	NL	NR	pu	pu	pu

lfybus
Ybus(9,9)=Ybus(9,9)+0.19j;
lfnewton
busout
lineflow

                   Power Flow Solution by Newton-Raphson Method
                      Maximum Power Mismatch = 1.72732e-09 
                             No. of Iterations = 10 

    Bus  Voltage  Angle    ------Load------    ---Generation---   Injected
    No.  Mag.     Degree     MW       Mvar       MW       Mvar       Mvar 
                                                                          
     1  1.0300   3.5088    0.0000    0.0000  114.1700   -6.8191    0.0000
     2  1.0250   1.1565   21.7000   12.7000   40.0000   45.8034    0.0000
     3  1.0100   0.0000   94.2000   19.1000  110.0764   14.2793    0.0000
     4  0.9866  -2.5719   47.8000   -3.9000    0.0000    0.0000    0.0000
     5  0.9874  -1.8275    7.6000    1.6000    0.0000    0.0000    0.0000
     6  1.0039  -7.5179   11.2000    7.5000    0.0000    0.0000    0.0000
     7  0.9984  -6.0951    0.0000    0.0000    0.0000    0.0000    0.0000
     8  0.9984  -6.0951    0.0000    0.0000    0.0000    0.0000    0.0000
     9  0.9945  -7.9743   29.5000   16.6000    0.0000    0.0000    0.0000
    10  0.9883  -8.2190    9.0000    5.8000    0.0000    0.0000    0.0000
    11  0.9924  -8.0181    3.5000    1.8000    0.0000    0.0000    0.0000
    12  0.9884  -8.4698    6.1000    1.6000    0.0000    0.0000    0.0000
    13  0.9837  -8.5480   13.8000    5.8000    0.0000    0.0000    0.0000
    14  0.9706  -9.3600   14.9000    5.0000    0.0000    0.0000    0.0000
      
    Total                259.3000   73.6000  264.2464   53.2636    0.0000


                           Line Flow and Losses 

     --Line--  Power at bus & line flow    --Line loss--  Transformer
     from  to    MW      Mvar     MVA       MW      Mvar      tap
   
     1        114.170   -6.819  114.373
           2   69.159  -15.245   70.820    0.902   -2.820
           5   45.011    8.426   45.792    1.091    0.044
   
     2         18.300   33.103   37.825
           1  -68.257   12.425   69.379    0.902   -2.820
           3   11.760    3.117   12.166    0.073   -3.563
           4   40.642    7.575   41.342    0.971   -2.034
           5   34.155    9.987   35.585    0.707   -1.283
   
     3         15.876   -4.821   16.592
           2  -11.687   -6.680   13.461    0.073   -3.563
           4   27.563    1.859   27.626    0.508   -2.153
   
     4        -47.800    3.900   47.959
           2  -39.672   -9.609   40.819    0.971   -2.034
           3  -27.056   -4.012   27.351    0.508   -2.153
           5  -27.808    6.465   28.550    0.113   -0.891
           7   29.596    5.915   30.181   -0.000    1.872    0.978
           9   17.140    5.141   17.894    0.000    1.718    0.969
   
     5         -7.600   -1.600    7.767
           1  -43.920   -8.382   44.713    1.091    0.044
           2  -33.448  -11.270   35.295    0.707   -1.283
           4   27.921   -7.355   28.874    0.113   -0.891
           6   41.846   25.408   48.956    0.000    5.381    0.932
   
     6        -11.200   -7.500   13.479
           5  -41.846  -20.026   46.391    0.000    5.381
          11    5.826    3.042    6.572    0.041    0.085
          12    7.637    2.482    8.030    0.079    0.164
          13   17.184    7.002   18.555    0.226    0.445
   
     7          0.000    0.000    0.000
           4  -29.596   -4.043   29.871   -0.000    1.872
           8    0.000   -0.000    0.000    0.000    0.000
           9   29.596    4.043   29.871    0.000    0.985
   
     8          0.000    0.000    0.000
           7   -0.000    0.000    0.000    0.000    0.000
   
     9        -29.500  -16.600   33.850
           4  -17.140   -3.423   17.478    0.000    1.718
           7  -29.596   -3.058   29.754    0.000    0.985
          10    6.742    4.713    8.226    0.022    0.058
          14   10.493    3.958   11.215    0.162    0.344
   
    10         -9.000   -5.800   10.707
           9   -6.720   -4.656    8.175    0.022    0.058
          11   -2.280   -1.144    2.551    0.005    0.013
   
    11         -3.500   -1.800    3.936
           6   -5.785   -2.957    6.497    0.041    0.085
          10    2.285    1.157    2.561    0.005    0.013
   
    12         -6.100   -1.600    6.306
           6   -7.558   -2.319    7.906    0.079    0.164
          13    1.458    0.719    1.625    0.006    0.005
   
    13        -13.800   -5.800   14.969
           6  -16.958   -6.557   18.181    0.226    0.445
          12   -1.452   -0.713    1.618    0.006    0.005
          14    4.610    1.470    4.838    0.041    0.084
   
    14        -14.900   -5.000   15.717
           9  -10.332   -3.614   10.946    0.162    0.344
          13   -4.568   -1.386    4.774    0.041    0.084
   
    Total loss                             4.946   -1.546